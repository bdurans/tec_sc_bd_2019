---
title: "Curso Big Data TEC: Tarea 3"
author: "Brian Durán"
output: html_document
editor_options: 
  chunk_output_type: console
---

<br>

#### Descripción tarea
Levanta una instancia local de Spark y ejecuta los siguientes pasos.

```{r}
library(nycflights13)
library(sparklyr)
```

<br>

#### Copia datos

<b>Inicar conexión con Spark</b>

```{r}
vuelos <- # aqui el codigo para copiar nycflights13::flights a Spark
aerolineas <- # aqui el codigo para copiar nycflights13::airlines a Spark
```

<b>Copiar los datos a Spark RDD</b>

<b> Cuandos RDD creó el paso arriba? </b>
### Ejecuta un join sobre spark

<b> Cuandos RDD creó el paso arriba? </b> <br>
Se crearon 2 RDD

<br>

#### Consultas
 
<b>Ejecuta un join sobre spark</b>

```{r}
# join (sobre spark) de vuelos y aerolineas
flights_airlines_tbl <- flights_tbl %>% left_join(airlines_tbl)
head(flights_airlines_tbl)
```

<b>Ejecuta un group_by sobre spark</b>

```{r}
# group_by por aerolinea reportando promedio de lo retrasos
promedio_retrasos <- flights_airlines_tbl %>%
  group_by(name) %>%
  summarise(media=mean(dep_delay, na.rm = TRUE))
promedio_retrasos
```

<br>

> Que pasa cuando cierras la sesión y la vuelves a abrir? 
> estan los resultados que tenias antes aun en tu instancia de Spark? 
> Explica lo que observas.
```{r}
# Standalone connection
# conf <- spark_config()
# conf$spark.executor.memory <- "2GB"
# conf$spark.memory.fraction <- 0.9
# conf$spark.executor.cores <- 2
# conf$spark.dynamicAllocation.enabled <- "false"

# sc <- spark_connect(master="spark://master-url:7077", 
#              version = "2.1.0",
#              config = conf,
#              spark_home = "/opt/spark/")
```

```{r}
library(sparklyr)
sc <- spark_connect(master = "local")
```

