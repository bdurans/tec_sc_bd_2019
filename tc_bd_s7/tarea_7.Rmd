---
title: "Big Data: Tarea 7"
author: "Brian Durán"
output: html_document
editor_options: 
  chunk_output_type: console
---

## Descripción

<p align="justify">

En la clase hablamos sobre como aplicar los metodos de machine learning a escala. Ya conocemos varios *frameworks* para hacerlo, y hemos visto que en R tenemos interfaces a ellas que nos faciliten usarlos al analisar nuestros datos. 


Para poner en practica lo que vimos en teoria en la Sesion 7, en este ejercicio pedimos que apliquen algun metodo de MLLib de Spark a los datos de vuelos (flights) que hemos usado antes en las tareas 3 y 4
</p>

### Usar MLlib de Spark
<p align="justify">
En este ejercicio tienes mucha libertad para ejecutarlo de la forma que te parece mejor. La clave es que el codigo corra contra los datos que estan en `nycflights13` y que entregues el html que resulta de tu Rmd con tu resultado. Como siempre generas este html apretando "knit" arriba. Si hay un error, resuelvelo antes de entregra la tarea.
</p>

```{r message=FALSE, warning=FALSE}
library(nycflights13)
library(sparklyr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(GGally)
```


```{r}
sc <- spark_connect(master = "local")
df <- drop_na(nycflights13::flights)
flights_tbl  <- copy_to(sc, df, "flights")

lm_model <- flights_tbl %>%
  select(dep_time, arr_time) %>%
  ml_linear_regression(dep_time ~ arr_time)

lm_model


flights_tbl %>%
  select(arr_time, dep_time) %>%
  collect %>%
  ggplot(aes(dep_time, arr_time)) +
    geom_point(aes(arr_time, dep_time), size = 2, alpha = 0.5) +
    geom_abline(aes(slope = coef(lm_model)[["arr_time"]],
                    intercept = coef(lm_model)[["(Intercept)"]]),
                color = "red") +
  labs(
    x = "arr_time",
    y = "dep_time",
    title = "Linear Regression: dep_time ~ arr_time",
    subtitle = "Use Spark.ML linear regression to predict dep_time as a function of arr_time."
  )

```

